{% extends 'SMAdminBundle::layout.html.twig' %}
{%block header%}Admin User{%endblock header%}
{% block body -%}
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading"> <i class="fa fa-users"></i> Danh sách tài khoản </div>
                <div class="panel-body">
                    <div class="dataTable_wrapper">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Tên</th>
                                    <th>Username</th>
                                    <th>Mail</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for entity in entities %}
                                    <tr>
                                        <td><a href="{{ path('admin_user_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>
                                        <td>{{ entity.firstname }} {{ entity.lastname }}</td>
                                        <td>{{ entity.username }}</td>
                                        <td>{{ entity.email }}</td>
                                        <td>
                                            {%if entity.getIdStatus.getIdStatus == 1%}
                                                <button class="btn btn-primary btn-circle" type="button" onclick="changeStatus({{entity.getIdStatus.getIdStatus}}, {{entity.id}});"><i class="fa fa-check"></i></button>
                                                {%else%}
                                                <button class="btn btn-danger btn-circle" type="button" onclick="changeStatus({{entity.getIdStatus.getIdStatus}}, {{entity.id}});"><i class="fa fa-times"></i></button>
                                            {%endif%}
                                        </td>
                                        <td>
                                            
                                            <a href="{{ path('admin_user_edit', { 'id': entity.id }) }}" class="btn btn-info">Edit</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                            <div class="navigation">
                                {{ knp_pagination_render(entities) }}
                            </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <a href="{{ path('admin_user_new') }}" class="btn btn-primary">
                        Thêm tài khoản
                    </a>
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
    function changeStatus(status,idAcc){
        var strQuestion = status == 1 ? "Bạn có muốn deactive account?" : "Bạn có muốn active account";
        var r = confirm(strQuestion);
        if (r == true) {
            $.ajax({
                url : "{{path('admin_user_ajax_active_deactive')}}",
                type : "post",
                dataType: 'json',
                data : {
                    status: status,
                    id: idAcc
                },
                success : function (result){
                    if (result.status == "success"){
                        if(status == 2){
                            $("[onclick='changeStatus(" + status + ", " + idAcc + ");']").parents("td").append('<button class="btn btn-primary btn-circle" type="button" onclick="changeStatus(1, ' + idAcc + ');"><i class="fa fa-check"></i></button>');
                            $("[onclick='changeStatus(" + status + ", " + idAcc + ");']").remove();
                        } else {
                            $("[onclick='changeStatus(" + status + ", " + idAcc + ");']").parents("td").append('<button class="btn btn-danger btn-circle" type="button" onclick="changeStatus(2, ' + idAcc + ');"><i class="fa fa-times"></i></button>');
                            $("[onclick='changeStatus(" + status + ", " + idAcc + ");']").remove();
                        }
                    }
                }
            });
        }
    }
</script>
{% endblock %}